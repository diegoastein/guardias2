<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consultas â€“ Guardias</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    // ðŸ” MISMO CONFIG QUE LA WEB PRINCIPAL
    const firebaseConfig = {
      apiKey: "AIzaSyB6AKWdDANzAjr5OHeskhT_KF_Gyco2fVY",
      authDomain: "guardias-5c5d9.firebaseapp.com",
      projectId: "guardias-5c5d9",
      storageBucket: "guardias-5c5d9.firebasestorage.app",
      messagingSenderId: "954058300552",
      appId: "1:954058300552:web:00135945002743e223d33d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    await signInAnonymously(auth);

    const { useState, useEffect } = React;

    function App() {
      const [medicos, setMedicos] = useState([]);
      const [licencias, setLicencias] = useState([]);
      const [medicoId, setMedicoId] = useState('');

      useEffect(() => {
        const unsubMed = onSnapshot(
          collection(db, "medicos"),
          snap => setMedicos(snap.docs.map(d => ({ id: d.id, ...d.data() })))
        );
        const unsubLic = onSnapshot(
          collection(db, "licencias"),
          snap => setLicencias(snap.docs.map(d => ({ id: d.id, ...d.data() })))
        );
        return () => { unsubMed(); unsubLic(); };
      }, []);

      const medicosOrdenados = [...medicos].sort((a,b) =>
        a.nombre.localeCompare(b.nombre)
      );

      const historial = licencias
        .filter(l => medicoId && String(l.medicoId) === String(medicoId))
        .sort((a,b) => a.desde.localeCompare(b.desde));

      return (
        React.createElement("div", { className: "min-h-screen bg-gray-100 p-4" },
          React.createElement("div", { className: "max-w-4xl mx-auto bg-white p-4 rounded shadow" },

            React.createElement("h1", { className: "text-xl font-bold mb-4" },
              "Historial de Licencias"
            ),

            React.createElement("select", {
              className: "w-full p-2 border rounded mb-4",
              value: medicoId,
              onChange: e => setMedicoId(e.target.value)
            },
              React.createElement("option", { value: "" }, "Seleccione un mÃ©dico"),
              medicosOrdenados.map(m =>
                React.createElement("option", { key: m.id, value: m.id }, m.nombre)
              )
            ),

            medicoId && React.createElement("table", { className: "w-full text-sm border" },
              React.createElement("thead", {},
                React.createElement("tr", { className: "bg-gray-50" },
                  ["Motivo","Desde","Hasta","Detalle"].map(h =>
                    React.createElement("th", { key: h, className: "border p-2 text-left" }, h)
                  )
                )
              ),
              React.createElement("tbody", {},
                historial.map(l =>
                  React.createElement("tr", { key: l.id },
                    React.createElement("td", { className: "border p-2" }, l.motivo),
                    React.createElement("td", { className: "border p-2" }, l.desde),
                    React.createElement("td", { className: "border p-2" }, l.hasta),
                    React.createElement("td", { className: "border p-2 text-xs" }, l.detalleCobertura || "")
                  )
                )
              )
            )

          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</head>

<body>
  <div id="root"></div>
</body>
</html>
